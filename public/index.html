<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Day Request</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            min-height: 100%;
            flex-direction: column;
            background-color: #fff;
            position: relative;
            overflow: hidden;
        }

        .container {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
            position: relative;
            z-index: 10;
            height: 350px;
            overflow: hidden;
        }

        .quote {
            font-size: 24px;
            margin-bottom: 20px;
            color: #e02f2f;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.3s;
        }

        #yesButton {
            background-color: #28a745;
            color: white;
            font-size: 18px;
        }

        #yesButton:hover {
            background-color: #218838;
        }

        #noButton {
            background-color: #dc3545;
            color: white;
            font-size: 18px;
        }

        #noButton:hover {
            background-color: #c82333;
        }

        #shareButton {
            background-color: #007bff;
            color: white;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        #shareButton:hover {
            background-color: #0056b3;
        }

        .message {
            font-size: 20px;
            margin-top: 20px;
            color: #28a745;
            display: none;
        }

        .heart {
            font-size: 30px;
            color: #e74c3c;
            margin-top: 10px;
        }

        /* Stylish Modal Popup */
        .modal-content {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.5s ease-out;
        }

        .modal-header {
            border-bottom: none;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            border-top: none;
        }

        .modal-title {
            font-size: 24px;
            color: #e02f2f;
        }

        .modal-body input {
            border: 2px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            width: 80%;
            font-size: 16px;
        }

        .btn-primary {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background-color: #218838;
            border-color: #218838;
        }

        /* Animations */
        @keyframes slideIn {
            0% {
                transform: translateY(-30px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .falling-heart {
            position: absolute;
            top: -50px;
            font-size: 30px;
            animation: fall 5s infinite linear;
            opacity: 0;
        }

        /* Footer Style */
        footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 16px;
            color: #333;
        }

        /* Modal Styles */
        .modal-backdrop {
            opacity: 0.8 !important;
        }

        /* Falling hearts animation */
        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Adding random scale and rotation for variation */
        @keyframes scale {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.5);
            }
            100% {
                transform: scale(1);
            }
        }

    </style>
</head>
<body>
    <!-- Modal for Name Input -->
    <div class="modal fade" id="nameModal" tabindex="-1" role="dialog" aria-labelledby="nameModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="modal-title" id="nameModalLabel">Welcome to my Valentine</h5>
                    <input type="text" id="nameInput" class="form-control" placeholder="Enter your name" required>
                </div>
                <div class="modal-footer">
                    <center><button type="button" class="btn btn-primary" id="saveNameBtn">Save Name</button></center>
                </div>
                <p>
                    1) "You can share it with your favorite person, and later view their response directly on the home page."<br />
                    2) "Choose a <b>tough, hard-to-guess name,</b> as this name acts like a password. It helps prevent misuse and ensures your valuable response remains secure."
                </p>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 class="quote">"Will you be my Valentine? ‚ù§Ô∏è"</h1>

        <div class="buttons">
            <button id="yesButton" class="btn btn-success btn-lg">Yes ‚ù§Ô∏è</button>
            <button id="noButton" class="btn btn-danger btn-lg">No üíî</button>
        </div>
        <div class="message" id="yesMessage">Yay! You said yes! ‚ù§Ô∏è</div>
        <div class="heart">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div> <!-- Love symbols -->
    </div>
    <br />
    <div id="hashes-container">
        <center></center><h3>"Your response will appear here."</h3>
        <p>The following users have accepted your invitation. These are the IDs from the shared URL.</p>
        <ul id="hashes-list">
            <!-- Distinct hashes will be appended here -->
        </ul></center>
    </div>
    <!-- Share Button at Top-Right -->
    <button id="shareButton" class="btn btn-primary btn-sm">Share</button>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        let userCount = 0;
        let noButtonSize = 18; // Initial font size for "No"
        let yesButtonSize = 18; // Initial font size for "Yes"
        //hash generate
        function generateRandomString(length = 6) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let randomString = '';

            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * chars.length);
                randomString += chars.charAt(randomIndex);
            }

            return randomString;
        }

        // Function to get the query parameter 'Id' from the URL
        function getQueryParameter(id) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(id);
        }

        // Check if 'id' parameter exists in the URL
        const nameFromUrl = getQueryParameter('id');

        if (nameFromUrl) {
            // Save 'id' parameter to localStorage
            localStorage.setItem('id', nameFromUrl);

            // Display the saved name in the result div
            //  document.getElementById('result').innerText = `Name from URL: ${nameFromUrl} has been saved to localStorage.`;
        } else {
            // document.getElementById('result').innerText = "No 'id' parameter found in the URL.";
            var dummy = generateRandomString(6);
            localStorage.setItem('id', dummy);
        }

        // Optionally, retrieve the saved name from localStorage and display it
        const savedName = localStorage.getItem('id');
        if (savedName) {
            console.log(`Saved ID in localStorage: ${savedName}`);
        }

        // Function to set a value in localStorage
        function setLocalStorage(name, value) {
            localStorage.setItem(name, value);
            hashval = generateRandomString(6);
            localStorage.setItem("hash", hashval);
        }

        // Function to get a value from localStorage
        function getLocalStorage(name) {
            return localStorage.getItem(name);
        }

        // Always show the modal on page load
        $('#nameModal').modal('show');

        // If name is stored in localStorage, enable the Yes button
        const storedName = getLocalStorage("userName");
        if (storedName) {
            document.getElementById("yesButton").disabled = false;
        } else {
            // You can optionally hide or reset the modal here if needed
            // $('#nameModal').modal('show');
        }

        // Rest of your code...


        const yesButton = document.getElementById("yesButton");
        const noButton = document.getElementById("noButton");
        const yesMessage = document.getElementById("yesMessage");
        const shareButton = document.getElementById("shareButton");
        const nameInput = document.getElementById("nameInput");
        //Ajax req for update like
        function sendlove() {
            // Get the input value
            var username = localStorage.getItem("userName");
            var hash = localStorage.getItem("id");
            var id = localStorage.getItem("hash");

            // Create an object to send
            var data = { name: username, id: id, hash: hash };


            // Send data using the Fetch API (AJAX)
            fetch('https://valantainfinder.netlify.app/.netlify/functions/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),  // Convert object to JSON string
            })
                .then(response => response.json())  // Parse the response as JSON
                .then(result => {
                    // Display the response from the server
                    //document.getElementById('result').innerText = result.message;
                })
                .catch(error => {
                    // document.getElementById('result').innerText = "Error: " + error.message;
                });
        }

        //share buttonclick
        function sendUser() {
            // Get the input value
            var username = localStorage.getItem("userName");
            var hash = localStorage.getItem("id");
            var id = localStorage.getItem("hash");


            // Create an object to send
            var data = { name: username, id: id, hash: hash };


            // Send data using the Fetch API (AJAX)
            fetch('https://valantainfinder.netlify.app/.netlify/functions/share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),  // Convert object to JSON string
            })
                .then(response => response.json())  // Parse the response as JSON
                .then(result => {
                    // Display the response from the server
                    //document.getElementById('result').innerText = result.message;
                })
                .catch(error => {
                    //document.getElementById('result').innerText = "Error: " + error.message;
                });
        }

        // Handle 'Yes' button click
        yesButton.addEventListener("click", () => {
            yesMessage.style.display = "block";
            userCount++;
            sendlove();
        });

        // Handle 'No' button hover to move it within the center box boundaries
        noButton.addEventListener("mouseenter", () => {
            const container = document.querySelector(".container");
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const buttonWidth = noButton.offsetWidth;
            const buttonHeight = noButton.offsetHeight;

            // Calculate random positions within the container, ensuring it doesn't overflow
            const randomX = Math.floor(Math.random() * (containerWidth - buttonWidth));
            const randomY = Math.floor(Math.random() * (containerHeight - buttonHeight));

            // Position the 'No' button inside the container
            noButton.style.position = "absolute";
            noButton.style.left = `${randomX}px`;
            noButton.style.top = `${randomY}px`;
        });

        // Handle 'No' button click
        noButton.addEventListener("click", () => {
            // Decrease size of 'No' button and increase size of 'Yes' button
            noButtonSize = Math.max(10, noButtonSize - 2); // Decrease 'No' button size, minimum 10px
            yesButtonSize = Math.min(30, yesButtonSize + 2); // Increase 'Yes' button size, maximum 30px

            // Apply updated sizes
            noButton.style.fontSize = `${noButtonSize}px`;
            yesButton.style.fontSize = `${yesButtonSize}px`;
        });

        // Handle Share button click
        shareButton.addEventListener("click", () => {
            //creating user
            sendUser()
            const name = getLocalStorage("userName");
            if (!name) {
                alert("Please enter your name before sharing!");
                return;
            }

            var hash = localStorage.getItem("hash");

            // Append the name to the share URL
            const shareUrl = `https://valantainfinder.netlify.app/?id=${encodeURIComponent(hash)}`;

            if (navigator.share) {
                navigator.share({
                    title: "Valentine's Day Request",
                    text: `Will you be my Valentine? ‚ù§Ô∏è - from ${name}`,
                    url: shareUrl
                }).then(() => {
                    console.log("Thanks for sharing!");
                }).catch((error) => {
                    console.error("Error sharing:", error);
                });
            } else {
                alert("Sharing is not supported on this device/browser.");
            }
        });

        // Handle Save Name button in modal
        document.getElementById("saveNameBtn").addEventListener("click", () => {
            const name = nameInput.value.trim();
            if (name) {
                setLocalStorage("userName", name); // Store name in localStorage
                $('#nameModal').modal('hide'); // Close modal
                document.getElementById("yesButton").disabled = false; // Enable Yes button
            } else {
                alert("Please enter your name!");
            }
        });


        function fetchDistinctHashes() {
            const userName = localStorage.getItem("userName");
            fetch(`/.netlify/functions/distinct-hashes=${userName}`)
                .then(response => response.json())
                .then(data => {
                    const hashesContainer = document.getElementById("hashes-container");
                    const hashesList = document.getElementById("hashes-list");

                    // Clear previous hashes before displaying new ones
                    hashesList.innerHTML = '';

                    if (data.distinctHashes && data.distinctHashes.length > 0) {
                        // Iterate over each hash and create a list item
                        data.distinctHashes.forEach(hash => {
                            const listItem = document.createElement("li");
                            listItem.textContent = 'ID: ' + hash.hash +' Likes You ‚ù§Ô∏è'; // Using the 'hash' field from the response
                            hashesList.appendChild(listItem);
                        });
                    } else {
                        // If no hashes are found, display a message
                        hashesList.innerHTML = '<li>No hashes found</li>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Check every 5 seconds
        setInterval(fetchDistinctHashes, 5000);

        // Function to create falling hearts
        function createFallingHearts() {
            const heart = document.createElement("div");
            heart.classList.add("falling-heart");
            heart.innerText = "‚ù§Ô∏è";

            // Randomize position and speed of falling hearts
            const randomX = Math.floor(Math.random() * window.innerWidth); // Random horizontal position
            const randomAnimationDuration = Math.floor(Math.random() * 5 + 5); // Between 5s and 10s for each heart

            heart.style.left = `${randomX}px`;
            heart.style.animationDuration = `${randomAnimationDuration}s`; // Apply random speed

            document.body.appendChild(heart);

            // Remove heart after animation ends
            heart.addEventListener("animationend", () => {
                heart.remove();
            });
        }

        // Create falling hearts every 0.5 seconds
        setInterval(createFallingHearts, 500);
    </script>

    <!-- Footer -->
    <footer>
        <p>Created by Anand Rajan</p>
    </footer>

</body>
</html>
